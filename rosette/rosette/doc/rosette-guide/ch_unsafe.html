<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>8&nbsp;Unsafe Operations</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="guide.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="autobib.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="file:///Applications/Racket%20v8.2/doc/local-redirect/local-redirect.js"></script><script type="text/javascript" src="file:///Users/wangshenyi/Library/Racket/8.2/doc/local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Rosette Guide</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="ch_getting-started.html" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="ch_essentials.html" class="tocviewlink" data-pltdoc="x">Rosette Essentials</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="ch_syntactic-forms.html" class="tocviewlink" data-pltdoc="x">Syntactic Forms</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="ch_built-in-datatypes.html" class="tocviewlink" data-pltdoc="x">Built-<wbr></wbr>In Datatypes</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ch_programmer-defined-datatypes.html" class="tocviewlink" data-pltdoc="x">Structures</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="ch_libraries.html" class="tocviewlink" data-pltdoc="x">Libraries</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="ch_symbolic-reflection.html" class="tocviewlink" data-pltdoc="x">Symbolic Reflection</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Unsafe Operations</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="ch_performance.html" class="tocviewlink" data-pltdoc="x">Performance</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="ch_error-tracing.html" class="tocviewlink" data-pltdoc="x">Debugging</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="refs.html" class="tocviewlink" data-pltdoc="x">References</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.2</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.2&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="sec_state-reflection.html" title="backward to &quot;7.2 Reflecting on Symbolic State&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Rosette Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_performance.html" title="forward to &quot;9 Performance&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;ch:unsafe&quot;">8<tt>&nbsp;</tt><a name="(part._ch~3aunsafe)"></a>Unsafe Operations</h3><p>Throughout this guide, we have assumed that Rosette programs are
written in the <span class="RktSym">rosette/safe</span> dialect of the full language.
This dialect extends a core subset of Racket with <a href="ch_essentials.html" data-pltdoc="x">solver-aided
functionality</a>.  In this chapter, we briefly discuss the <span class="RktSym">rosette</span>
dialect of the language, which exports all of Racket.</p><p>Safe use of the full <span class="RktSym">rosette</span> language requires a basic understanding
of how Rosette&rsquo;s Symbolic Virtual Machine (SVM) works  <span class="Autobibref">&nbsp;[<a href="refs.html#%28autobib._.Emina._.Torlak._and._.Rastislav._.Bodik.A._.Lightweight._.Symbolic._.Virtual._.Machine._for._.Solver-.Aided._.Host._.Languages.Programming._.Language._.Design._and._.Implementation._%28.P.L.D.I%292014%29" class="AutobibLink" data-pltdoc="x">3</a>]</span>.
Briefly, the SVM hijacks the normal Racket execution for all procedures and
constructs that are exported by <span class="RktSym">rosette/safe</span>.  Any programs that are
implemented exclusively in the <span class="RktSym">rosette/safe</span> language are therefore
fully under the SVM&rsquo;s control.  This means that the SVM can correctly interpret
the application of a procedure or a macro to a symbolic value, and it
can correctly handle any side-effects (in particular, writes to memory) performed
by <span class="RktSym">rosette/safe</span> code.</p><p><div class="SIntrapara">The following snippet demonstrates the non-standard execution that the SVM needs to
perform in order to assign the expected meaning to Rosette code:
</div><div class="SIntrapara"><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">If b is true, then y[1] should be 3, otherwise y[2] should be 4:</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-set%2521%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">vector-set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-set%2521%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">vector-set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The state of y correctly accounts for both possibilities:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> * If the solver finds that b must be #t, then the contents</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">   of y will be #(0 3 2).</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> * Otherwise, the contents of y will be #(0 1 4)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">y</span></td></tr><tr><td><p><span class="RktRes">(vector 0 (ite b 3 1) (ite b 2 4))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sol1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._solve%29%29" class="RktStxLink" data-pltdoc="x">solve</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">sol1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#(0 3 2)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sol2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._solve%29%29" class="RktStxLink" data-pltdoc="x">solve</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">sol2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#(0 1 4)</span></p></td></tr></table></blockquote></div></p></div></p><p>Because the SVM controls only the execution of <span class="RktSym">rosette/safe</span> code,
it cannot, in general, guarantee the safety or correctness of arbitrary <span class="RktSym">rosette</span> programs.
As soon as a <span class="RktSym">rosette</span> program calls an <a href="ch_syntactic-forms.html#%28tech._lifted._construct%29" class="techoutside" data-pltdoc="x"><span class="techinside">unlifted</span></a> Racket construct
(that is, a procedure or a macro not implemented in or provided by the <span class="RktSym">rosette/safe</span> language),
the execution escapes back to the Racket interpreter.  The SVM has no control over the side-effects
performed by the Racket interpreter, or the meaning that it (perhaps incorrectly) assigns to programs
in the presence of symbolic values.  As a result, the programmer is responsible for ensuring that
a <span class="RktSym">rosette</span> program continues to behave correctly after the execution returns from the Racket interpreter.</p><p>As an example of incorrect behavior, consider the following <span class="RktSym">rosette</span> snippet.
The procedures <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-hash%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">make-hash</a></span>, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span>, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-clear%2521%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-clear!</a></span> are not in <span class="RktSym">rosette/safe</span>.
Whenever they are invoked, the execution escapes to the Racket interpreter.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-hash%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">make-hash</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">key</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">integer?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The following call produces an incorrect value. Intuitively, we expect the</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">output to be the symbolic number that is either 2 or 0, depending on whether</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">the key is 1 or something else.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="hspace">&nbsp;</span><span class="RktSym">key</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The following call produces an incorrect state. Intuitively, we expect h</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">to be empty if b is true and unchanged otherwise.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=when_unless.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._when%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-clear%2521%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-clear!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">(vc b #t)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">h</span></td></tr><tr><td><p><span class="RktRes">'#hash()</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">When is it safe to use a Racket procedure or macro?  The answer depends on their semantics.
A conservative rule is to only use an unlifted construct <span class="RktVar">c</span> in an <a name="(tech._effectively._concrete)"></a><span style="font-style: italic">effectively concrete</span> <a href="sec_state-reflection.html#%28tech._program._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">program state</span></a>.
The SVM is in such a state when
</div><div class="SIntrapara"><ol><li><p>the current <a href="sec_state-reflection.html#%28tech._verification._condition%29" class="techoutside" data-pltdoc="x"><span class="techinside">verification condition</span></a> is true, i.e., <span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-true~3f%29%29" class="RktValLink" data-pltdoc="x">vc-true?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span>; and,</p></li><li><p>all local and global variables that may be read by <span class="RktVar">c</span> contain <a name="(tech._fully._concrete._value)"></a><span style="font-style: italic">fully concrete value</span>s. A
value (e.g., a list) is fully concrete if no symbolic values can be reached by recursively traversing its structure.</p></li></ol></div><div class="SIntrapara">The above uses of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-clear%2521%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-clear!</a></span> violate these
requirements: <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span> is reading a symbolic value, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-clear%2521%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">hash-clear!</a></span> is
evaluated in a state with a symbolic verification condition.</div></p><p>Being conservative, the above rule disallows many scenarios in which it is still safe to use
Racket constructs.  These, however, have to be considered on a case-by-case basis.  For example,
it is safe to use Racket&rsquo;s iteration and comprehension constructs, such as <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">for</a></span> or <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%252Flist%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">for/list</a></span>,
as long as they iterate over concrete sequences, and all guard expressions produce fully concrete values in
each iteration.  In practice, Rosette programs can safely use many common Racket constructs, and with a
bit of experience, it becomes easy to see when it is okay to break the effectively-concrete rule.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.2&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="sec_state-reflection.html" title="backward to &quot;7.2 Reflecting on Symbolic State&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Rosette Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_performance.html" title="forward to &quot;9 Performance&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>