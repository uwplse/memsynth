<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2&nbsp;Rosette Essentials</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="guide.css" title="default"/><link rel="stylesheet" type="text/css" href="autobib.css" title="default"/><link rel="stylesheet" type="text/css" href="footnote.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="file:///Applications/Racket%20v8.2/doc/local-redirect/local-redirect.js"></script><script type="text/javascript" src="file:///Users/wangshenyi/Library/Racket/8.2/doc/local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Rosette Guide</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="ch_getting-started.html" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Rosette Essentials</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="ch_syntactic-forms.html" class="tocviewlink" data-pltdoc="x">Syntactic Forms</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="ch_built-in-datatypes.html" class="tocviewlink" data-pltdoc="x">Built-<wbr></wbr>In Datatypes</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ch_programmer-defined-datatypes.html" class="tocviewlink" data-pltdoc="x">Structures</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="ch_libraries.html" class="tocviewlink" data-pltdoc="x">Libraries</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="ch_symbolic-reflection.html" class="tocviewlink" data-pltdoc="x">Symbolic Reflection</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="ch_unsafe.html" class="tocviewlink" data-pltdoc="x">Unsafe Operations</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="ch_performance.html" class="tocviewlink" data-pltdoc="x">Performance</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="ch_error-tracing.html" class="tocviewlink" data-pltdoc="x">Debugging</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="refs.html" class="tocviewlink" data-pltdoc="x">References</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Rosette Essentials</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#%28part._sec~3asymbolic-values%29" class="tocviewlink" data-pltdoc="x">Symbolic Values</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#%28part._sec~3aasserts%29" class="tocviewlink" data-pltdoc="x">Assertions and Assumptions</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="#%28part._sec~3aqueries%29" class="tocviewlink" data-pltdoc="x">Solver-<wbr></wbr>Aided Queries</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="#%28part._sec~3anotes%29" class="tocviewlink" data-pltdoc="x">Symbolic Reasoning</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._sec~3asymbolic-values%29" class="tocsubseclink" data-pltdoc="x">Symbolic Values</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._sec~3aasserts%29" class="tocsubseclink" data-pltdoc="x">Assertions and Assumptions</a></td></tr><tr><td><span class="tocsublinknumber">2.3<tt>&nbsp;</tt></span><a href="#%28part._sec~3aqueries%29" class="tocsubseclink" data-pltdoc="x">Solver-<wbr></wbr>Aided Queries</a></td></tr><tr><td><span class="tocsublinknumber">2.3.1<tt>&nbsp;</tt></span><a href="#%28part._sec~3averify%29" class="tocsubseclink" data-pltdoc="x">Verification</a></td></tr><tr><td><span class="tocsublinknumber">2.3.2<tt>&nbsp;</tt></span><a href="#%28part._sec~3asynthesize%29" class="tocsubseclink" data-pltdoc="x">Synthesis</a></td></tr><tr><td><span class="tocsublinknumber">2.3.3<tt>&nbsp;</tt></span><a href="#%28part._sec~3asolve%29" class="tocsubseclink" data-pltdoc="x">Angelic Execution</a></td></tr><tr><td><span class="tocsublinknumber">2.4<tt>&nbsp;</tt></span><a href="#%28part._sec~3anotes%29" class="tocsubseclink" data-pltdoc="x">Symbolic Reasoning</a></td></tr><tr><td><span class="tocsublinknumber">2.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Mixing_.Theories%29" class="tocsubseclink" data-pltdoc="x">Mixing Theories</a></td></tr><tr><td><span class="tocsublinknumber">2.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Reasoning_.Precision%29" class="tocsubseclink" data-pltdoc="x">Reasoning Precision</a></td></tr><tr><td><span class="tocsublinknumber">2.4.3<tt>&nbsp;</tt></span><a href="#%28part._.Symbolic_.Evaluation%29" class="tocsubseclink" data-pltdoc="x">Symbolic Evaluation</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.2</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.2&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="ch_getting-started.html" title="backward to &quot;1 Getting Started&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Rosette Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_syntactic-forms.html" title="forward to &quot;3 Syntactic Forms&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;ch:essentials&quot;">2<tt>&nbsp;</tt><a name="(part._ch~3aessentials)"></a>Rosette Essentials</h3><p>Rosette adds to Racket a collection of solver-aided facilities.
These facilities enable programmers to conveniently access a constraint solver
that can answer interesting questions about program behaviors.  They are based on four
key concepts: <span class="emph">symbolic values</span>, <span class="emph">assertions</span>, <span class="emph">assumptions</span>, and <span class="emph">queries</span>.
We use assertions and assumptions to express desired program behaviors and symbolic values to
formulate queries about these behaviors.</p><p>This chapter illustrates the basics of solver-aided programming.
More advanced tutorials, featuring extended examples, can be found
in Section 2 of <span class="Autobibref">&nbsp;[<a href="refs.html#%28autobib._.Emina._.Torlak._and._.Rastislav._.Bodik.Growing._.Solver-.Aided._.Languages._with._.Rosette.New._.Ideas%2C._.New._.Paradigms%2C._and._.Reflections._on._.Programming._and._.Software._%28.Onward%21%292013%29" class="AutobibLink" data-pltdoc="x">2</a>, <a href="refs.html#%28autobib._.Emina._.Torlak._and._.Rastislav._.Bodik.A._.Lightweight._.Symbolic._.Virtual._.Machine._for._.Solver-.Aided._.Host._.Languages.Programming._.Language._.Design._and._.Implementation._%28.P.L.D.I%292014%29" class="AutobibLink" data-pltdoc="x">3</a>]</span>.<span class="Footnote"><span class="FootnoteRef"><span style="vertical-align: super; font-size: 80%"><a href="#%28counter-%28%29._%28gentag._1._%28lib._rosette%2Fguide%2Fscribble%2Frosette-guide..scrbl%29%29%29" data-pltdoc="x">1</a></span></span><span class="FootnoteContent">Code examples in
these references are written in earlier versions of Rosette.
While Rosette 4 is not backward compatible with these versions,
they share the same conceptual core.</span></span></p><p>The following chapters describe the subset
of Racket that can be <a href="ch_getting-started.html#%28part._sec~3alangs%29" data-pltdoc="x">safely</a> used with solver-aided facilities, including the
supported datatypes (both <a href="ch_built-in-datatypes.html" data-pltdoc="x">built-in</a>
and <a href="ch_programmer-defined-datatypes.html" data-pltdoc="x">programmer-defined</a>),
<a href="ch_syntactic-forms.html" data-pltdoc="x">syntactic forms</a>, and <a href="ch_libraries.html" data-pltdoc="x">libraries</a>.</p><h4 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:symbolic-values&quot;">2.1<tt>&nbsp;</tt><a name="(part._sec~3asymbolic-values)"></a>Symbolic Values</h4><p>The Rosette language includes two kinds of values: concrete and symbolic.  Concrete values are plain Racket values (<span class="RktVal">#t</span>, <span class="RktVal">#f</span>, <span class="RktVal">0</span>, <span class="RktVal">1</span>, etc.), and Rosette programs that operate only on concrete values behave like Racket programs.  Accessing the solver-aided features of Rosette&#8212;<wbr></wbr>such as code synthesis or verification&#8212;<wbr></wbr>requires the use of symbolic values.</p><p><div class="SIntrapara"><a name="(tech._symbolic._constant)"></a><span style="font-style: italic">Symbolic constants</span> are the simplest kind of symbolic value.  They can be created using the <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span> form:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">b</span></td></tr><tr><td><p><span class="RktRes">b</span></p></td></tr></table></blockquote></div><div class="SIntrapara">This generates a fresh symbolic constant of type boolean and binds it to the variable <span class="RktSym">b</span>.</div></p><p>You can think of a symbolic constant as a placeholder for a concrete constant of the same type. As we will see shortly, the solver, once called, determines which concrete value a given symbolic constant represents:  it will tell us whether the constant <span class="RktRes">b</span> is <span class="RktVal">#t</span> or <span class="RktVal">#f</span>, depending on what question we ask about the behavior of a program (or a procedure) applied to <span class="RktRes">b</span>.</p><p><div class="SIntrapara">Symbolic values, including constants, can be used just like concrete values of the same type.  They can be stored in data structures or passed to procedures to obtain other values, either concrete or symbolic:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">integer?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">vector</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(vector b 1)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(! b)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div><div class="SIntrapara">In our example, all but the fourth expression produce concrete values.  The fourth expression returns another symbolic value&#8212;<wbr></wbr>specifically, a symbolic <span class="emph">expression</span> of type boolean.  This expression represents the negation of <span class="RktRes">b</span>.  If the solver determines that <span class="RktRes">b</span> is <span class="RktVal">#t</span>, for example, then <span class="RktRes">(! b)</span> will be interpreted as <span class="RktVal">#f</span>.</div></p><p><div class="SIntrapara">Rosette provides one more construct for creating symbolic constants besides <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%2A%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">integer?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The two constructs differ in how they bind variables to constants when evaluated more than once.
The <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span> form binds the variable to the same (unique) constant every time it is evaluated. The <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%2A%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic*</a></span> form, in contrast, creates a stream of (unique) constants, binding the variable to the next constant from its stream whenever the form is evaluated. The following example illustrates the difference:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">static</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Creates the same constant when evaluated.</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dynamic</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%2A%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">integer?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Creates a fresh constant when evaluated.</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">static</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">static</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dynamic</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dynamic</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(= y$1 y$2)</span></p></td></tr></table></blockquote></div></p><p>Printed constant names, such as <span class="RktRes">x</span> or <span class="RktRes">b</span>, are just comments.  Two constants created by evaluating two distinct <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span> (or, <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%2A%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic*</a></span>) forms are distinct, even if they have the same printed name.  They may still represent the same concrete value, but that is determined by the solver:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">yet-another-x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">static</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">yet-another-x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(&lt;=&gt; x x)</span></p></td></tr></table></blockquote><h4 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:asserts&quot;">2.2<tt>&nbsp;</tt><a name="(part._sec~3aasserts)"></a>Assertions and Assumptions</h4><p><div class="SIntrapara">Like many languages, Rosette provides a construct for expressing <span class="emph">assertions</span>&#8212;<wbr></wbr>important properties of programs that are checked in every execution.  Rosette assertions work just like Java or Racket assertions when given a concrete value:  if the value is false, the execution terminates with a runtime exception.  Otherwise, the execution proceeds normally.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">[assert] failed</span></p></td></tr></table></blockquote></div></p><p>When given a symbolic boolean value, however, a Rosette assertion has no immediate effect.  Instead, the value is accumulated in the current <a href="sec_state-reflection.html#%28tech._verification._condition%29" class="techoutside" data-pltdoc="x"><span class="techinside">verification condition</span></a> (VC), and the assertion&rsquo;s effect (whether it passes or fails) is eventually determined by the solver.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-asserts%29%29" class="RktValLink" data-pltdoc="x">vc-asserts</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">We asserted #f above, so the current VC reflects that.</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._clear-vc%21%29%29" class="RktValLink" data-pltdoc="x">clear-vc!</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Clear the current VC.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-asserts%29%29" class="RktValLink" data-pltdoc="x">vc-asserts</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Add the assertion (not b) to the VC.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-asserts%29%29" class="RktValLink" data-pltdoc="x">vc-asserts</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(! b)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._clear-vc%21%29%29" class="RktValLink" data-pltdoc="x">clear-vc!</a></span><span class="RktPn">)</span></td></tr></table></blockquote><p>Assertions express properties that a program must satisfy on all <span class="emph">legal</span> inputs. In Rosette, as in other solver-aided frameworks, we use <span class="emph">assumptions</span> to describe which inputs are legal. If a program violates an assertion on a legal input, we blame the program. But if it violates an assertion on an illegal input, we blame the caller. In other words, a program is considered incorrect only when it violates an assertion on a legal input.</p><p>Assumptions behave analogously to assertions on both concrete and symbolic values. In the concrete case, assuming <span class="RktVal">#f</span> aborts the execution with a runtime exception, and assuming a true value is equivalent to calling <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span>. In the symbolic case, the assumed value is accumulated in the current VC.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-assumes%29%29" class="RktValLink" data-pltdoc="x">vc-assumes</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Assuming #f aborts the execution with an exception.</span></td></tr><tr><td><p><span class="RktErr">[assume] failed</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-assumes%29%29" class="RktValLink" data-pltdoc="x">vc-assumes</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._clear-vc%21%29%29" class="RktValLink" data-pltdoc="x">clear-vc!</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">j</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">integer?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3e%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">j</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Add the assumption (&gt; j 0) to the VC.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-assumes%29%29" class="RktValLink" data-pltdoc="x">vc-assumes</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(&lt; 0 j)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3c%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">j</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc-asserts%29%29" class="RktValLink" data-pltdoc="x">vc-asserts</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The assertions must hold when the assumptions hold.</span></td></tr><tr><td><p><span class="RktRes">(|| (! (&lt; 0 j)) (&lt; (+ i (- j)) i))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">VC tracks the assumptions and the assertions.</span></td></tr><tr><td><p><span class="RktRes">(vc (&lt; 0 j) (|| (! (&lt; 0 j)) (&lt; (+ i (- j)) i)))</span></p></td></tr></table></blockquote><h4 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:queries&quot;">2.3<tt>&nbsp;</tt><a name="(part._sec~3aqueries)"></a>Solver-Aided Queries</h4><p>The solver reasons about assumed and asserted properties only when we ask a question about them&#8212;<wbr></wbr>for example, "Does my program have an execution that violates an assertion while satisfying all the assumptions?"  We pose such <span class="emph">solver-aided queries</span> with the help of constructs explained in the remainder of this chapter.</p><p>We will illustrate the queries on the following toy example. Suppose that we want to implement a
procedure <span class="RktSym">bvmid</span> that takes as input two non-negative 32-bit integers, <span class="RktSym">lo</span> &#8804; <span class="RktSym">hi</span>,
and returns the midpoint of the interval [<span class="RktSym">lo</span>, <span class="RktSym">hi</span>]. In C or Java, we would declare
the inputs and output of <span class="RktSym">bvmid</span> to be of type &ldquo;int&rdquo;. In Rosette, we model finite precision
(i.e., machine) integers as <a href="sec_bitvectors.html" data-pltdoc="x">bitvectors</a> of length 32.</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">int32? is a shorthand for the type (bitvector 32).</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">int32?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bitvector%29%29" class="RktValLink" data-pltdoc="x">bitvector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">32</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">int32 takes as input an integer literal and returns</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">the corresponding 32-bit bitvector value.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bv</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">int32?</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">int32?</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">1 is not a 32-bit integer</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">int32?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">but (int32 1) is.</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x00000001 32)</span></p></td></tr></table></blockquote></div></p><p>Bitvectors support the usual operations on machine integers, and we can use them to implement <span class="RktSym">bvmid</span> as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Returns the midpoint of the interval [lo, hi].</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(lo + hi) / 2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsdiv%29%29" class="RktValLink" data-pltdoc="x">bvsdiv</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>As the above implementation suggests, we intend the midpoint to be the mathematical
integer <span class="stt">mi = (lo + hi) / 2</span>, where <span class="stt">/</span> stands for integer division. Assuming
that <span class="stt">0 &#8804; lo &#8804; hi</span>, the midpoint <span class="stt">mi</span> is fully characterized by two properties:
(1) <span class="stt">lo &#8804; mi &#8804; hi</span> and (2) <span class="stt">0 &#8804; (hi - mi) - (mi - lo) &#8804; 1</span>. We can use these
properties to define a generic correctness specification for any implementation of
<span class="RktSym">bvmid</span> as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">impl</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Assuming that</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">0 &#8804; lo and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">lo &#8804; hi,</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mi</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">impl</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">and letting mi = impl(lo, hi) and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">diff</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">diff = (hi - mi) - (mi - lo),</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsub%29%29" class="RktValLink" data-pltdoc="x">bvsub</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsub%29%29" class="RktValLink" data-pltdoc="x">bvsub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="hspace">&nbsp;</span><span class="RktSym">mi</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsub%29%29" class="RktValLink" data-pltdoc="x">bvsub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mi</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">we require that</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">mi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">lo &#8804; mi,</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mi</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">mi &#8804; hi,</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">diff</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">0 &#8804; diff, and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">diff</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">diff &#8804; 1.</span></td></tr></table></td></tr></table></blockquote><p>This is not the only way to specify the behavior of <span class="RktSym">bvmid</span>, and we will see an
alternative specification later on. In general, there are many ways to describe what it
means for a program to be correct, and often, these descriptions are partial:
they constrain some aspects of the implementation (e.g., the output is positive)
without fully defining its behavior. In our example, <span class="RktSym">check-mid</span> is a
<span class="emph">full functional correctness specification</span> in that it admits exactly one output value for <span class="RktPn">(</span><span class="RktSym">impl</span><span class="stt"> </span><span class="RktSym">lo</span><span class="stt"> </span><span class="RktSym">hi</span><span class="RktPn">)</span>, namely, <span class="stt">(lo + hi) / 2</span>.</p><p>Testing <span class="RktSym">bvmid</span> against its specification on a few concrete legal inputs, we find
that it triggers no assertion failures, as expected:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">10000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>But does it work correctly on <span class="emph">all</span> legal inputs?  The answer, as we will see below, is &ldquo;no&rdquo;.
In fact, <span class="RktSym">bvmid</span> reproduces  <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm#Implementation_issues">a famous bug</a>
that lurked for years in widely used C and Java implementations of binary search.</p><h5 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:verify&quot;">2.3.1<tt>&nbsp;</tt><a name="(part._sec~3averify)"></a>Verification</h5><p>How can we check if <span class="RktSym">bvmid</span> satisfies its specification on all legal inputs? One approach is to enumerate all pairs of 32-bit integers with <span class="RktVal">0</span><span class="stt"> </span><span class="RktSym">&#8804;</span><span class="stt"> </span><span class="RktSym">lo</span><span class="stt"> </span><span class="RktSym">&#8804;</span><span class="stt"> </span><span class="RktSym">hi</span> and apply <span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="stt"> </span><span class="RktSym">bvmid</span><span class="stt"> </span><span class="RktSym">hi</span><span class="stt"> </span><span class="RktSym">lo</span><span class="RktPn">)</span> to each. This approach is sound (it is guaranteed to find a bug if one exists), but a quick calculation shows that it is impractical even for our toy example: <span class="RktSym">bvmid</span> has roughly 2.3 &#215; 10<span style="vertical-align: super; font-size: 80%">18</span> legal inputs. A better approach is to delegate such checks to a constraint solver, which can search  large input spaces much more effectively than naive enumeration.  In Rosette, this is done with the help of the <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span> query:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="hspace">&nbsp;</span><span class="RktSym">int32?</span><span class="RktPn">)</span></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">cex</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x394f0402 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x529e7c00 32)])</span></p></td></tr></table></td></tr></table></blockquote><p>The <span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="stt"> </span><span class="RktVar">expr</span><span class="RktPn">)</span> form queries the solver for a <a name="(tech._binding)"></a><span style="font-style: italic">binding</span> from symbolic constants to concrete values that causes the evaluation of <span class="RktVar">expr</span> to violate an assertion, while satisfying all the assumptions, when the bound symbolic constants are replaced with the corresponding concrete values. If such a binding exists, as it does in our case, it is called a <span class="emph">counterexample</span>.</p><p><div class="SIntrapara">Bindings are first-class values in Rosette, and they can be freely manipulated by programs.  We can also interpret any Rosette value with respect to a binding using the built-in <span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span> procedure:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">cex</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="hspace">&nbsp;</span><span class="RktSym">cex</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list (bv #x394f0402 32) (bv #x529e7c00 32))</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">We can convert these values to integer? constants for debugging:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">il</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ih</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">il</span><span class="hspace">&nbsp;</span><span class="RktSym">ih</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(961479682 1386118144)</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Here is the computed midpoint:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">m</span></td></tr><tr><td><p><span class="RktRes">(bv #xc5f6c001 32)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-973684735</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">This is clearly wrong. We expect (il + ih) / 2 instead:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._quotient%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">quotient</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">il</span><span class="hspace">&nbsp;</span><span class="RktSym">ih</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1173798913</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Expressed as a 32-bit integer, the correct answer is:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._quotient%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">quotient</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">il</span><span class="hspace">&nbsp;</span><span class="RktSym">ih</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x45f6c001 32)</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">So, check-mid fails on (bvmid cl ch):</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">[assert] failed</span></p></td></tr></table></blockquote></div></p><p>In our example, evaluating <span class="RktSym">l</span> and <span class="RktSym">h</span> with respect to <span class="RktSym">cex</span> reveals that <span class="RktSym">bvmid</span> fails to return the correct midpoint value, thus causing the first assertion in the <span class="RktSym">check-mid</span> procedure to fail. The bug is due to overflow:
the expression <span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="stt"> </span><span class="RktSym">lo</span><span class="stt"> </span><span class="RktSym">hi</span><span class="RktPn">)</span> in <span class="RktSym">bvmid</span> produces a negative value in
the 32-bit representation when the sum of
<span class="RktSym">lo</span> and <span class="RktSym">hi</span> exceeds 2<span style="vertical-align: super; font-size: 80%">31</span>-1.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x8bed8002 32)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cl</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-1947369470</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">il</span><span class="hspace">&nbsp;</span><span class="RktSym">ih</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2347597826</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expt%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">expt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">31</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2147483647</span></p></td></tr></table></blockquote><p>A common  <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm#Implementation_issues">solution</a>
to this problem is to calculate the midpoint as <span class="stt">lo + ((hi - lo) / 2)</span>. It is easy to see that all intermediate values in this calculation are at most <span class="RktSym">hi</span> when <span class="RktSym">lo</span> and <span class="RktSym">hi</span> are both non-negative, so no overflow can happen. We can also verify this with Rosette:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsdiv%29%29" class="RktValLink" data-pltdoc="x">bvsdiv</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsub%29%29" class="RktValLink" data-pltdoc="x">bvsub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(unsat)</span></p></td></tr></table></blockquote><h5 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:synthesize&quot;">2.3.2<tt>&nbsp;</tt><a name="(part._sec~3asynthesize)"></a>Synthesis</h5><p>The solution given in <span class="RktSym">bvmid-no-overflow</span> avoids the overflow problem in <span class="RktSym">bvmid</span> at the cost of performing an additional arithmetic operation. Both implementations also rely on signed division, which is slow and expensive compared to addition, subtraction, and bitwise operations. So our ideal implementation would be correct, small, and composed of only cheap arithmetic and bitwise operations. Does such an implementation exist?  To find out, we turn to Rosette&rsquo;s <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._synthesize%29%29" class="RktStxLink" data-pltdoc="x">synthesize</a></span> query.</p><p>The synthesis query uses the solver to search for a correct program in a space of candidate implementations defined by a syntactic <a name="(tech._sketch)"></a><span style="font-style: italic">sketch</span>. A sketch is a program with <a name="(tech._hole)"></a><span style="font-style: italic">holes</span>, which the solver fills with expressions drawn from a specified set of options. For example, <span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._~3f~3f%29%29" class="RktStxLink" data-pltdoc="x">??</a></span><span class="stt"> </span><span class="RktSym">int32?</span><span class="RktPn">)</span> stands for a hole that can be filled with any 32-bit integer constant, so the sketch <span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="stt"> </span><span class="RktSym">x</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._~3f~3f%29%29" class="RktStxLink" data-pltdoc="x">??</a></span><span class="stt"> </span><span class="RktSym">int32?</span><span class="RktPn">)</span><span class="RktPn">)</span> represents all 2<span style="vertical-align: super; font-size: 80%">32</span> programs that add a 32-bit constant to the variable <span class="RktSym">x</span>. Rosette also lets you define richer holes that can be filled with expressions from a given grammar. For example, here is a grammar of all <span class="RktSym">int32?</span> expressions that consist of cheap arithmetic and bitwise operations:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rosette/lib/synthax</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Require the sketching library.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._define-grammar%29%29" class="RktStxLink" data-pltdoc="x">define-grammar</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fast-int32</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Grammar of int32 expressions over two inputs:</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">expr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._~3f~3f%29%29" class="RktStxLink" data-pltdoc="x">??</a></span><span class="hspace">&nbsp;</span><span class="RktSym">int32?</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">&lt;expr&gt; := x | y | &lt;32-bit integer constant&gt; |</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">bop</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">          (&lt;bop&gt; &lt;expr&gt; &lt;expr&gt;) |</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">uop</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">          (&lt;uop&gt; &lt;expr&gt;)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">bop</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsub%29%29" class="RktValLink" data-pltdoc="x">bvsub</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvand%29%29" class="RktValLink" data-pltdoc="x">bvand</a></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">&lt;bop&gt;  := bvadd  | bvsub | bvand |</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvor%29%29" class="RktValLink" data-pltdoc="x">bvor</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvxor%29%29" class="RktValLink" data-pltdoc="x">bvxor</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvshl%29%29" class="RktValLink" data-pltdoc="x">bvshl</a></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">          bvor   | bvxor | bvshl |</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvashr%29%29" class="RktValLink" data-pltdoc="x">bvashr</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">          bvlshr | bvashr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">uop</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvneg%29%29" class="RktValLink" data-pltdoc="x">bvneg</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvnot%29%29" class="RktValLink" data-pltdoc="x">bvnot</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">&lt;uop&gt;  := bvneg | bvnot</span></td></tr></table></td></tr></table></blockquote><p>Using this grammar, we can sketch a fast implementation of the midpoint calculation as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-fast</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fast-int32</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="hspace">&nbsp;</span><span class="RktPn">#:depth</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The above sketch describes the space of all expressions from the <span class="RktSym">fast-int32</span> grammar that have parse trees of depth at most 2. The depth argument is optional. If ommitted, Rosette will use the value of the <span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28def._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._current-grammar-depth%29%29" class="RktValLink" data-pltdoc="x">current-grammar-depth</a></span><span class="RktPn">)</span> parameter to bound the depth of the expressions drawn from the grammar.</p><p>At this point, it is worth noting that holes and sketches are not fundamental concepts in Rosette. Instead, they are macros defined in terms of the core constructs we have already seen, symbolic constants and assertions. For example,  <span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._~3f~3f%29%29" class="RktStxLink" data-pltdoc="x">??</a></span><span class="stt"> </span><span class="RktSym">int32?</span><span class="RktPn">)</span> is syntactic sugar for <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fform%2Fdefine..rkt%29._define-symbolic%29%29" class="RktStxLink" data-pltdoc="x">define-symbolic</a></span><span class="stt"> </span><span class="RktVar">id</span><span class="stt"> </span><span class="RktSym">int32?</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVar">id</span><span class="RktPn">)</span>, where <span class="RktVar">id</span> is an internally generated name. Similarly, <span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvneg%29%29" class="RktValLink" data-pltdoc="x">bvneg</a></span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvnot%29%29" class="RktValLink" data-pltdoc="x">bvnot</a></span><span class="RktPn">)</span> expands to <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._~3f~3f%29%29" class="RktStxLink" data-pltdoc="x">??</a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvneg%29%29" class="RktValLink" data-pltdoc="x">bvneg</a></span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvnot%29%29" class="RktValLink" data-pltdoc="x">bvnot</a></span><span class="RktPn">)</span>. Finally, a grammar hole such as <span class="RktPn">(</span><span class="RktSym">fast-int32</span><span class="stt"> </span><span class="RktSym">lo</span><span class="stt"> </span><span class="RktSym">hi</span><span class="stt"> </span><span class="RktPn">#:depth</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span> inlines its productions <span class="RktPn">#:depth</span> times to create a nested expression of the form <span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym">lo</span><span class="stt"> </span><span class="RktSym">hi</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._~3f~3f%29%29" class="RktStxLink" data-pltdoc="x">??</a></span><span class="stt"> </span><span class="RktSym">int32?</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvneg%29%29" class="RktValLink" data-pltdoc="x">bvneg</a></span><span class="stt"> </span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvnot%29%29" class="RktValLink" data-pltdoc="x">bvnot</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28form._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._choose%29%29" class="RktStxLink" data-pltdoc="x">choose</a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>. Assigning concrete values to the symbolic constants generated by this expression has the effect of selecting a parse tree (of depth 2 in our example) from the hole&rsquo;s grammar. So, completing a sketch is a matter of finding a suitable binding for the symbolic constants generated by the holes.</p><p>With this in mind, we can query the solver for a completion of the <span class="RktSym">bvmid-fast</span> sketch (if any) that satisfies our correctness specification:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Save the above definitions to a file before calling print-forms.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sol</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._synthesize%29%29" class="RktStxLink" data-pltdoc="x">synthesize</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:forall</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:guarantee</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-fast</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">sol</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[0$choose:bvmid:37:9$expr:bvmid:37:3$fast-int32:bvmid:45:3 #f]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[1$choose:bvmid:37:9$expr:bvmid:37:3$fast-int32:bvmid:45:3 #f]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[2$choose:bvmid:37:9$expr:bvmid:37:3$fast-int32:bvmid:45:3 #f]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[3$choose:bvmid:37:9$expr:bvmid:37:3$fast-int32:bvmid:45:3 #t]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">...)</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28def._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._print-forms%29%29" class="RktValLink" data-pltdoc="x">print-forms</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sol</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">(define (bvmid-fast lo hi) (bvlshr (bvadd hi lo) (bv #x00000001 32)))</span></p></td></tr></table></blockquote><p>The synthesis query takes the form <span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._synthesize%29%29" class="RktStxLink" data-pltdoc="x">synthesize</a></span><span class="stt"> </span><span class="RktPn">#:forall</span><span class="stt"> </span><span class="RktVar">input</span><span class="stt"> </span><span class="RktPn">#:guarantee</span><span class="stt"> </span><span class="RktVar">expr</span><span class="RktPn">)</span>, where <span class="RktVar">input</span> lists the symbolic constants that represent inputs to a sketched program, and <span class="RktVar">expr</span> gives the correctness specification for the sketch. The solver searches for a binding from the hole (i.e., non-<span class="RktVar">input</span>) constants to values such that <span class="RktVar">expr</span> satisfies its assertions on all legal <span class="RktVar">input</span>s. Passing this binding to <span class="RktSym"><a href="sec_rosette-libs.html#%28def._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._print-forms%29%29" class="RktValLink" data-pltdoc="x">print-forms</a></span> converts it to a syntactic representation of the completed sketch.<span class="Footnote"><span class="FootnoteRef"><span style="vertical-align: super; font-size: 80%"><a href="#%28counter-%28%29._%28gentag._2._%28lib._rosette%2Fguide%2Fscribble%2Frosette-guide..scrbl%29%29%29" data-pltdoc="x">2</a></span></span><span class="FootnoteContent"><span class="RktSym"><a href="sec_rosette-libs.html#%28def._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._print-forms%29%29" class="RktValLink" data-pltdoc="x">print-forms</a></span> works only on sketches that have been saved to disk.</span></span> In our example, the synthesized program implements the midpoint calculation using the logical shift operation, i.e., the midpoint between <span class="RktSym">lo</span> and <span class="RktSym">hi</span> is calculated as <span class="stt">(lo + hi) &gt;&gt;</span><span style="vertical-align: sub; font-size: 80%">u</span><span class="stt"> 1</span>.</p><h5 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:solve&quot;">2.3.3<tt>&nbsp;</tt><a name="(part._sec~3asolve)"></a>Angelic Execution</h5><p>Rosette supports one more solver-aided query, which we call angelic execution. This query is the dual of verification.  Given a program with symbolic values, it instructs the solver to find a binding for them that will cause the program to execute normally&#8212;<wbr></wbr>that is, without any assumption or assertion failures.</p><p><div class="SIntrapara">Angelic execution can be used to solve puzzles, to run incomplete code, or to "invert" a program, by searching for inputs that produce a desired output.  For example, we can ask the solver to search for two distinct legal inputs, <span class="RktSym">l</span> and <span class="RktSym">h</span>, whose midpoint is the bitwise-and of their bits:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-fast</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bv</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">32</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sol</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._solve%29%29" class="RktStxLink" data-pltdoc="x">solve</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=begin.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._begin%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">begin</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvand%29%29" class="RktValLink" data-pltdoc="x">bvand</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-fast</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">sol</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x3f761e94 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x3f761e95 32)])</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvand%29%29" class="RktValLink" data-pltdoc="x">bvand</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sol</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x3f761e94 32)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-fast</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sol</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x3f761e94 32)</span></p></td></tr></table></blockquote></div><div class="SIntrapara">As a fun exercise that builds on this result, try using program synthesis to discover the condition, <span class="RktPn">(</span><span class="RktSym">bvmid-and?</span><span class="stt"> </span><span class="RktSym">l</span><span class="stt"> </span><span class="RktSym">h</span><span class="RktPn">)</span>, that is both necessary and sufficient to ensure that <span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvand%29%29" class="RktValLink" data-pltdoc="x">bvand</a></span> and <span class="RktSym">bvmid-fast</span> produce the same value on all distinct legal inputs <span class="RktSym">l</span> and <span class="RktSym">r</span>. (Hint: you can reuse the <span class="RktSym">fast-int32</span> grammar from the previous section.)</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-and?</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">&lt;--- replace with your sketch
</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_rosette-libs.html#%28def._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._print-forms%29%29" class="RktValLink" data-pltdoc="x">print-forms</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._synthesize%29%29" class="RktStxLink" data-pltdoc="x">synthesize</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:forall</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:guarantee</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=begin.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._begin%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">begin</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;=&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-and?</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvand%29%29" class="RktValLink" data-pltdoc="x">bvand</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmid-fast</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><h4 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;sec:notes&quot;">2.4<tt>&nbsp;</tt><a name="(part._sec~3anotes)"></a>Symbolic Reasoning</h4><p>We conclude this chapter with a quick overview of common patterns and anti-patterns for programming in Rosette. For more details, see Chapters <a href="ch_unsafe.html" data-pltdoc="x">8</a>&ndash;<a href="ch_error-tracing.html" data-pltdoc="x">10</a>.</p><h5 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;Mixing_Theories&quot;">2.4.1<tt>&nbsp;</tt><a name="(part._.Mixing_.Theories)"></a>Mixing Theories</h5><p>Rosette implements solver-aided queries by translating them to the input language of an SMT solver. By default, this translation respects types: a symbolic constant of type <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">integer?</a></span> will be translated to an SMT constant of the same type, i.e., an infinite precision mathematical integer. These types determine which <span class="emph">theories</span> the solver will need to use to solve a query. As a rule of thumb, the theory of bitvectors tends to elicit fastest solving times, and mixing theories can lead to severe performance degradation. For that reason, it is best to use the types from the same theory throughout your program (e.g., bitvectors).</p><p>To illustrate the impact of mixing theories, consider the following mixed-theory specification for our midpoint example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">impl</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Assuming that</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">0 &#8804; lo and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">lo &#8804; hi,</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">we require that</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">equal?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">impl</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">&#8968;impl(lo, hi)&#8969; = </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._quotient%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">quotient</a></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(&#8968;lo&#8969; + &#8968;hi&#8969;) / 2, where</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktSym">lo</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">&#8968;e&#8969; stands for the mathematical</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bitvector-&gt;integer</span><span class="hspace">&nbsp;</span><span class="RktSym">hi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">integer corresponding to the</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">32-bit integer e.</span></td></tr></table></td></tr></table></blockquote><p>This new specification uses both bitvectors and integers. Compared to <span class="RktSym">check-mid</span>, which uses only bitvectors, <span class="RktSym">check-mid-slow</span> causes one of our verification queries to become an order of magnitude slower and the other to time out:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 0 real time: 38 gc time: 0</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x394f0402 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x529e7c00 32)])</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 1 real time: 172 gc time: 0</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x2faef9a1 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x5eefb8dd 32)])</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 0 real time: 160 gc time: 0</span></p></td></tr><tr><td><p><span class="RktRes">(unsat)</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Sandboxed_Evaluation.html%23%2528form._%2528%2528lib._racket%252Fsandbox..rkt%2529._with-deep-time-limit%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">with-deep-time-limit</a></span><span class="hspace">&nbsp;</span><span class="RktVal">600</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Timeout after 10 minutes ...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktErr">call-with-deep-time-limit: out of time</span></p></td></tr></table></blockquote><h5 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;Reasoning_Precision&quot;">2.4.2<tt>&nbsp;</tt><a name="(part._.Reasoning_.Precision)"></a>Reasoning Precision</h5><p>While slower than bitvectors, integers are more convenient to use for demos, prototyping, and interfacing with Racket. To bridge this gap, Rosette provides the option of approximating symbolic integers (and reals) as bitvectors of length <span class="RktVar">k</span>, by setting the <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span> parameter to <span class="RktVar">k</span>. With this setting, integers (and reals) are treated as infinite precision values during evaluation, but when solving queries, they are translated to bitvectors of length <span class="RktVar">k</span> for better performance.</p><p><div class="SIntrapara">For example, our slow midpoint queries become orders-of-magnitude faster when allowed to approximate integers with bitvectors:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">By default, current-bitwidth is set to #f, so Rosette translates</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">integer? values precisely, using the SMT theory of integers.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">After we set current-bitwidth to 64, integer? values in</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">check-mid-slow are translated to SMT bitvectors of length 64.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span><span class="hspace">&nbsp;</span><span class="RktVal">64</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 0 real time: 23 gc time: 0</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x00000001 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x7fffffff 32)])</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 0 real time: 159 gc time: 0</span></p></td></tr><tr><td><p><span class="RktRes">(unsat)</span></p></td></tr></table></blockquote></div></p><p>In this example, we have chosen <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span> carefully to ensure that the resulting approximation is both performant and sound&#8212;<wbr></wbr>i.e., the approximate query returns a counterexample exactly when one would be returned by the corresponding integer query. But choosing the right bitwidth is difficult to do in general. If we underapproximate the number of bits that are needed to represent every integer value in a query, we lose soundness, and if we overapproximate it, we lose performance.</p><p><div class="SIntrapara">For instance, when we re-run the slow midpoint queries with <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span> set to 32, the buggy query fails to produce a counterexample and the correct query returns a bogus counterexample.  Both results are correct for 32-bit machine integers but incorrect for (infinite-precision) mathematical integers:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The bitwidth is too low, so we get ...</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span><span class="hspace">&nbsp;</span><span class="RktVal">32</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">no counterexample to a buggy query, and</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 0 real time: 0 gc time: 0</span></p></td></tr><tr><td><p><span class="RktRes">(unsat)</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">a bogus counterexample to a correct query.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 1 real time: 152 gc time: 0</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x71979fa3 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x76b91b88 32)])</span></p></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">We can restore soundness by sacrificing performance and setting <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span> conservatively to a large value (e.g., 512). In our case, the queries are small so an order-of-magnitude slowdown is acceptable. For large queries, this would lead to timeouts:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The bitwidth is too high, so we get a 3-10X slowdown.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span><span class="hspace">&nbsp;</span><span class="RktVal">512</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 1 real time: 385 gc time: 0</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x70000006 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x73fffffa 32)])</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid-no-overflow</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 0 real time: 430 gc time: 0</span></p></td></tr><tr><td><p><span class="RktRes">(unsat)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">In practice, it is usually best to leave <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span> at its default setting (<span class="RktVal">#f</span>), and limit the use of integers to code that will be evaluated concretely. This approach works especially well when the solver is configured to accept only bitvectors, so if any integers have made it into a query, the solver fails fast:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Ffinitize..rkt%29._current-bitwidth%29%29" class="RktValLink" data-pltdoc="x">current-bitwidth</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rosette/solver/smt/z3</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._current-solver%29%29" class="RktValLink" data-pltdoc="x">current-solver</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">z3</span><span class="hspace">&nbsp;</span><span class="RktPn">#:logic</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">QF_BV</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Allow only bitvectors.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Accepted.</span></td></tr><tr><td><p><span class="RktOut">cpu time: 3 real time: 33 gc time: 0</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(model</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[l (bv #x394f0402 32)]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[h (bv #x529e7c00 32)])</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-mid-slow</span><span class="hspace">&nbsp;</span><span class="RktSym">bvmid</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Rejected.</span></td></tr><tr><td><p><span class="RktErr">read-solution: unrecognized solver output: (error line 68</span></p></td></tr><tr><td><p><span class="RktErr">column 19: Invalid function definition: unknown sort 'Int')</span></p></td></tr></table></blockquote></div></p><h5 x-source-module="(lib &quot;rosette/guide/scribble/rosette-guide.scrbl&quot;)" x-source-pkg="rosette" x-part-tag="&quot;Symbolic_Evaluation&quot;">2.4.3<tt>&nbsp;</tt><a name="(part._.Symbolic_.Evaluation)"></a>Symbolic Evaluation</h5><p>The process by which Rosette turns a query into an SMT constraint is called <a name="(tech._symbolic._evaluation)"></a><span style="font-style: italic">symbolic evaluation</span>. At a high level, Rosette&rsquo;s symbolic evaluation works by executing <span class="emph">all</span> paths through a program, and collecting all the assumptions and assertions on these paths into the current verification condition <span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span>. The resulting <span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._vc%29%29" class="RktValLink" data-pltdoc="x">vc</a></span><span class="RktPn">)</span> is then translated to the SMT language and passed to the solver.  This evaluation model has two practical implications on writing performant and terminating Rosette code.</p><p>First, if a program is slow or runs forever under standard (concrete) evaluation, it will perform at least as poorly under all-path (symbolic) evaluation. Second, if a program terminates quickly on all concrete inputs, it can still perform poorly or fail to terminate on symbolic inputs. So, extra care must be taken to ensure good performance and termination in the presence of symbolic values.</p><p><div class="SIntrapara">To illustrate, consider the procedure <span class="RktSym">bvsqrt</span> for computing the <a href="https://en.wikipedia.org/wiki/Integer_square_root#Using_bitwise_operations">integer square root</a> of non-negative 32-bit integers. This procedure terminates on all concrete values of <span class="RktSym">n</span> but runs forever when given a symbolic input:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">bvult</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvshl%29%29" class="RktValLink" data-pltdoc="x">bvshl</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvugt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmul</span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">s0</span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x00000001 32)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x00000002 32)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x00000003 32)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(bv #x00000004 32)</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=Sandboxed_Evaluation.html%23%2528form._%2528%2528lib._racket%252Fsandbox..rkt%2529._with-deep-time-limit%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">with-deep-time-limit</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Timeout after 10 seconds ...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktErr">call-with-deep-time-limit: out of time</span></p></td></tr></table></blockquote></div><div class="SIntrapara">The reason is simple: a call to <span class="RktSym">bvsqrt</span> terminates when <span class="RktSym">n</span> becomes less than 2. But if we start with a symbolic <span class="RktSym">n</span>, this never happens because Rosette right-shifts <span class="RktSym">n</span> by 2 in each recursive call to generate a new symbolic value:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n0</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">n0</span></td></tr><tr><td><p><span class="RktRes">l</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">n1</span></td></tr><tr><td><p><span class="RktRes">(bvlshr l (bv #x00000002 32))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">n2</span></td></tr><tr><td><p><span class="RktRes">(bvlshr (bvlshr l (bv #x00000002 32)) (bv #x00000002 32))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">n3</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(bvlshr</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(bvlshr (bvlshr l (bv #x00000002 32)) (bv #x00000002 32))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(bv #x00000002 32))</span></p></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">In general, recursion terminates under symbolic evaluation only when the stopping condition is reached with concrete values.</div></p><p>We can force termination by placing a concrete bound <span class="RktVar">k</span> on the number of times <span class="RktSym">bvsqrt</span> can call itself recursively. This approach is called <a name="(tech._finitization)"></a><span style="font-style: italic">finitization</span>, and it is the standard way to handle unbounded loops and recursion under symbolic evaluation. The following code shows how to implement a <span class="emph">sound</span> finitization policy. If a <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span> query returns <span class="RktPn">(</span><span class="RktSym">unsat</span><span class="RktPn">)</span> under a sound policy, we know that (1) the unrolling bound <span class="RktVar">k</span> is sufficient to execute all possible inputs to  <span class="RktSym">bvsqrt</span>, and (2) all of these executions satisfy the query. If we pick a bound that is too small, the query will generate a counterexample input that needs a larger bound to compute the result. In our example, the bound of 16 is sufficient to verify the correctness of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sqrt%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">sqrt</a></span> on all inputs:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Parameter that controls the number of unrollings (5 by default).</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fuel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-parameter%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">make-parameter</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A simple macro for defining bounded procedures</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">that use (fuel) to limit recursion.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._define-syntax-rule%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define-syntax-rule</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">define-bounded</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">id</span><span class="hspace">&nbsp;</span><span class="RktSym">param</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">id</span><span class="hspace">&nbsp;</span><span class="RktSym">param</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3e%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fuel</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Out of fuel."</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._parameterize%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">fuel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sub1%2529%2529&amp;version=8.2" class="RktValLink Sq" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fuel</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Computes bvsqrt taking at most (fuel) steps.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-bounded</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">bvult</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvshl%29%29" class="RktValLink" data-pltdoc="x">bvshl</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvlshr%29%29" class="RktValLink" data-pltdoc="x">bvlshr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvugt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmul</span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">s0</span><span class="hspace">&nbsp;</span><span class="RktSym">s1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Correctness specification for bvsqrt:</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-sqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">impl</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvsle%29%29" class="RktValLink" data-pltdoc="x">bvsle</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Assuming n &#8805; 0,</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">impl</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n+1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_bitvectors.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._bvadd%29%29" class="RktValLink" data-pltdoc="x">bvadd</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int32</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">we require that</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvule</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmul</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(&#8730;n)^2 &#8804; n and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvult</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bvmul</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n+1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8730;n+1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">n &lt; (&#8730;n + 1)^2.</span></td></tr></table></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Verification fails due to insufficient fuel.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-sqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 4 real time: 1143 gc time: 0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="sec_solvers-and-solutions.html#%28def._%28%28lib._rosette%2Fquery%2Fquery..rkt%29._evaluate%29%29" class="RktValLink" data-pltdoc="x">evaluate</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">cex</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">[assert] Out of fuel.</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="sec_state-reflection.html#%28def._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._clear-vc%21%29%29" class="RktValLink" data-pltdoc="x">clear-vc!</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Verification succeeds with enough fuel.</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">fuel</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.2/doc/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._time%2529%2529&amp;version=8.2" class="RktStxLink Sq" data-pltdoc="x">time</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-sqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">bvsqrt</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">cpu time: 4 real time: 67938 gc time: 0</span></p></td></tr><tr><td><p><span class="RktRes">(unsat)</span></p></td></tr></table></blockquote><p>Many other finitization policies can be defined in a similar way. For example, if we change <span class="RktSym">define-bounded</span> to use <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assume%29%29" class="RktStxLink" data-pltdoc="x">assume</a></span> instead of <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fbase%2Fbase..rkt%29._assert%29%29" class="RktStxLink" data-pltdoc="x">assert</a></span>, we obtain a finitization policy that ensures <span class="emph">completeness</span>. If a <span class="RktSym"><a href="ch_syntactic-forms_rosette.html#%28form._%28%28lib._rosette%2Fquery%2Fform..rkt%29._verify%29%29" class="RktStxLink" data-pltdoc="x">verify</a></span> query returns a counterexample under a complete policy, we know that the program is buggy, and it violates a query assertion within <span class="RktVar">k</span> recursive calls. But if the query returns <span class="RktPn">(</span><span class="RktSym">unsat</span><span class="RktPn">)</span>, we know only that there are no bugs within <span class="RktVar">k</span> or fewer unrollings&#8212;<wbr></wbr>we cannot conclude anything about longer executions. So a complete policy prevents false positives, while a sound one prevents false negatives. What kind of policy to use depends on the application, and Rosette leaves that choice to the programmer.</p><a name="(part._(gentag._0._(lib._rosette/guide/scribble/rosette-guide..scrbl)))"></a><p class="FootnoteBlock"><div class="SIntrapara"><p class="FootnoteBlockContent"><span class="FootnoteTarget"><span style="vertical-align: super; font-size: 80%"><a name="(counter-()._(gentag._1._(lib._rosette/guide/scribble/rosette-guide..scrbl)))"></a>1</span></span>Code examples in
these references are written in earlier versions of Rosette.
While Rosette 4 is not backward compatible with these versions,
they share the same conceptual core.</p></div><div class="SIntrapara"><p class="FootnoteBlockContent"><span class="FootnoteTarget"><span style="vertical-align: super; font-size: 80%"><a name="(counter-()._(gentag._2._(lib._rosette/guide/scribble/rosette-guide..scrbl)))"></a>2</span></span><span class="RktSym"><a href="sec_rosette-libs.html#%28def._%28%28lib._rosette%2Flib%2Fsynthax..rkt%29._print-forms%29%29" class="RktValLink" data-pltdoc="x">print-forms</a></span> works only on sketches that have been saved to disk.</p></div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.2&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="ch_getting-started.html" title="backward to &quot;1 Getting Started&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Rosette Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_syntactic-forms.html" title="forward to &quot;3 Syntactic Forms&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>